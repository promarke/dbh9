# ğŸ¨ à¦¡à§‡à¦Ÿà¦¾ à¦«à§à¦²à§‹ à¦à¦¬à¦‚ à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦® à¦†à¦°à§à¦•à¦¿à¦Ÿà§‡à¦•à¦šà¦¾à¦° à¦¡à¦¾à¦¯à¦¼à¦¾à¦—à§à¦°à¦¾à¦®
**à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦“à¦¯à¦¼à¦¾à¦°à§à¦•à¦«à§à¦²à§‹ à¦­à¦¿à¦œà§à¦¯à§à¦¯à¦¼à¦¾à¦²à¦¾à¦‡à¦œà§‡à¦¶à¦¨**

---

## ğŸ—ï¸ à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦® à¦†à¦°à§à¦•à¦¿à¦Ÿà§‡à¦•à¦šà¦¾à¦° à¦“à¦­à¦¾à¦°à¦­à¦¿à¦‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DUBAI BORKA HOUSE SYSTEM                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   FRONTEND (React)   â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚   CONVEX BACKEND     â”‚       â”‚
â”‚  â”‚                      â”‚        â”‚  (Serverless)        â”‚       â”‚
â”‚  â”‚ â”œâ”€ Sales Component   â”‚        â”‚ â”œâ”€ sales.ts          â”‚       â”‚
â”‚  â”‚ â”œâ”€ Refund Component  â”‚        â”‚ â”œâ”€ refunds.ts        â”‚       â”‚
â”‚  â”‚ â”œâ”€ Inventory         â”‚        â”‚ â”œâ”€ products.ts       â”‚       â”‚
â”‚  â”‚ â”œâ”€ Customers         â”‚        â”‚ â”œâ”€ customers.ts      â”‚       â”‚
â”‚  â”‚ â””â”€ Reports           â”‚        â”‚ â”œâ”€ loyalty.ts        â”‚       â”‚
â”‚  â”‚                      â”‚        â”‚ â”œâ”€ stockManagement.tsâ”‚       â”‚
â”‚  â”‚ useQuery()â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤  query API           â”‚       â”‚
â”‚  â”‚ useMutation()â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â–º  mutation API         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                           â”‚                      â”‚
â”‚                                           â–¼                      â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                   â”‚ CONVEX DATABASE  â”‚           â”‚
â”‚                                   â”‚                  â”‚           â”‚
â”‚                                   â”‚ - Sales          â”‚           â”‚
â”‚                                   â”‚ - Refunds        â”‚           â”‚
â”‚                                   â”‚ - Products       â”‚           â”‚
â”‚                                   â”‚ - Customers      â”‚           â”‚
â”‚                                   â”‚ - Inventory      â”‚           â”‚
â”‚                                   â”‚ - Audit Trails   â”‚           â”‚
â”‚                                   â”‚ - Loyalty        â”‚           â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° REFUND WORKFLOW - à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦¡à§‡à¦Ÿà¦¾ à¦«à§à¦²à§‹

### Phase 1ï¸âƒ£: à¦°à¦¿à¦«à¦¾à¦¨à§à¦¡ à¦…à¦¨à§à¦°à§‹à¦§ à¦¤à§ˆà¦°à¦¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER ACTION: New Refund                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Frontend: RefundManagement    â”‚
        â”‚                                â”‚
        â”‚ 1. Select Sale                 â”‚
        â”‚ 2. Select Items                â”‚
        â”‚ 3. Fill Form (reason, method)  â”‚
        â”‚ 4. Click "Create"              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Mutation: refunds.create      â”‚
        â”‚                                â”‚
        â”‚ Validate:                      â”‚
        â”‚ âœ“ Sale exists                  â”‚
        â”‚ âœ“ Policy check                 â”‚
        â”‚ âœ“ Time window                  â”‚
        â”‚ âœ“ Amount > 0                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    INSERT: refunds table                â”‚
        â”‚                                        â”‚
        â”‚ {                                      â”‚
        â”‚   refundNumber: "REF-1234567890"      â”‚
        â”‚   saleId: "SAL-001"                   â”‚
        â”‚   items: [...]                        â”‚
        â”‚   status: "pending"                   â”‚
        â”‚   approvalStatus: "pending_approval"  â”‚
        â”‚   requestDate: timestamp               â”‚
        â”‚ }                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  INSERT: refundAuditTrail               â”‚
        â”‚  - Action: "created"                   â”‚
        â”‚  - User: currentUser                   â”‚
        â”‚  - Timestamp: now                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Frontend: useQuery auto-update        â”‚
        â”‚  - refunds list refreshes             â”‚
        â”‚  - New refund appears in list         â”‚
        â”‚  - UI shows "pending_approval"        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 2ï¸âƒ£: à¦°à¦¿à¦«à¦¾à¦¨à§à¦¡ à¦…à¦¨à§à¦®à§‹à¦¦à¦¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              USER ACTION: Approve Refund                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Mutation: refunds.approve     â”‚
        â”‚                                â”‚
        â”‚ Check:                         â”‚
        â”‚ âœ“ Refund exists                â”‚
        â”‚ âœ“ Status = pending_approval    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PATCH: refunds table              â”‚
        â”‚                                   â”‚
        â”‚ Update:                           â”‚
        â”‚ approvalStatus: "approved"        â”‚
        â”‚ approvalDate: timestamp            â”‚
        â”‚ approvedBy: userId                â”‚
        â”‚ approvedByName: userName          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  INSERT: refundAuditTrail           â”‚
        â”‚  - Action: "approved"              â”‚
        â”‚  - Status change: pendingâ†’approved â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  UI Update: Real-time              â”‚
        â”‚  - Status badge changes            â”‚
        â”‚  - "Approve" button disappears     â”‚
        â”‚  - "Process" button appears        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 3ï¸âƒ£: à¦°à¦¿à¦«à¦¾à¦¨à§à¦¡ à¦ªà§à¦°à¦¸à§‡à¦¸à¦¿à¦‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              USER ACTION: Process Refund                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Mutation: refunds.process     â”‚
        â”‚                                â”‚
        â”‚ Check:                         â”‚
        â”‚ âœ“ Refund exists                â”‚
        â”‚ âœ“ Status = approved            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PATCH: refunds table              â”‚
        â”‚                                   â”‚
        â”‚ Update:                           â”‚
        â”‚ status: "processed"               â”‚
        â”‚ processedDate: timestamp          â”‚
        â”‚ refundDetails: {...}              â”‚
        â”‚ processedBy: userId               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  INSERT: refundAuditTrail           â”‚
        â”‚  - Action: "processed"             â”‚
        â”‚  - Status: pendingâ†’processed       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  UI Update: Real-time              â”‚
        â”‚  - Shows payment processing status â”‚
        â”‚  - "Process" button disabled       â”‚
        â”‚  - "Complete" button now active    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 4ï¸âƒ£: UNDO SALE (à¦°à¦¿à¦«à¦¾à¦¨à§à¦¡ à¦¸à¦®à§à¦ªà¦¨à§à¦¨à¦¤à¦¾) - à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦ªà§à¦°à¦•à§à¦°à¦¿à¦¯à¦¼à¦¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     USER ACTION: Complete Refund (TRIGGERS UNDO SALE)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Mutation: refunds.complete     â”‚
         â”‚                                â”‚
         â”‚  Check:                        â”‚
         â”‚  âœ“ Refund exists               â”‚
         â”‚  âœ“ Status = processed          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           7-STEP UNDO SALE PROCESS BEGINS              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    
    STEP 1: Update Refund Status
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PATCH: refunds table                     â”‚
    â”‚                                          â”‚
    â”‚ status: "completed"                      â”‚
    â”‚ completedDate: timestamp                 â”‚
    â”‚ isReturned: true                         â”‚
    â”‚ returnDate: timestamp                    â”‚
    â”‚ returnCondition: "Good" (user input)     â”‚
    â”‚ inspectionNotes: "..." (user input)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Refund marked as COMPLETED            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP 2: Mark Original Sale as CANCELLED
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET: sales table [saleId]                â”‚
    â”‚ â†’ Get original sale details              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PATCH: sales table [saleId]              â”‚
    â”‚                                          â”‚
    â”‚ status: "cancelled"  â—„â”€â”€ KEY CHANGE      â”‚
    â”‚                                          â”‚
    â”‚ Effect:                                  â”‚
    â”‚ - Sales.list query filters it out       â”‚
    â”‚ - Not shown in "Active Sales" anymore   â”‚
    â”‚ - Shows in "Cancelled/Returned" list    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Sale CANCELLED - Hidden from UI       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP 3: Restore Products to Inventory
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ FOR EACH item in refund.items:           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT: stockMovements table             â”‚
    â”‚                                          â”‚
    â”‚ {                                        â”‚
    â”‚   productId: item.productId              â”‚
    â”‚   type: "in" (stock coming IN)           â”‚
    â”‚   quantity: item.quantity                â”‚
    â”‚   reason: "Undo Sale Return"             â”‚
    â”‚   reference: refund.refundNumber         â”‚
    â”‚   timestamp: now                         â”‚
    â”‚   userId: currentUser                    â”‚
    â”‚ }                                        â”‚
    â”‚                                          â”‚
    â”‚ This creates audit trail for stock      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET: products table [productId]          â”‚
    â”‚ â†’ Get current stock                      â”‚
    â”‚   currentStock: n                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PATCH: products table [productId]        â”‚
    â”‚                                          â”‚
    â”‚ Update:                                  â”‚
    â”‚ currentStock: n + item.quantity          â”‚
    â”‚                    â†‘ ADD BACK            â”‚
    â”‚                                          â”‚
    â”‚ BEFORE: currentStock = 5                 â”‚
    â”‚ RETURN: item.quantity = 2                â”‚
    â”‚ AFTER:  currentStock = 7  âœ…             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PATCH: products table [productId]        â”‚
    â”‚        branchStock array                 â”‚
    â”‚                                          â”‚
    â”‚ Update branch-specific stock:            â”‚
    â”‚ For matching branchId:                   â”‚
    â”‚ branchStock[i].currentStock += quantity  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Stock RESTORED                         â”‚
    â”‚    Global + Branch-specific updated     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP 4: Reverse Loyalty Points
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET: customers table [customerId]        â”‚
    â”‚ â†’ Get customer loyalty points            â”‚
    â”‚   loyaltyPoints: 100                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ QUERY: pointsTransactions                â”‚
    â”‚        Filter by:                        â”‚
    â”‚        - transactionType: "purchase"     â”‚
    â”‚        - referenceId: saleId             â”‚
    â”‚                                          â”‚
    â”‚ â†’ Find all points earned from this sale â”‚
    â”‚   Calculate: totalPointsToReverse = 50  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT: pointsTransactions               â”‚
    â”‚                                          â”‚
    â”‚ {                                        â”‚
    â”‚   customerId: customerId                 â”‚
    â”‚   transactionType: "refund"              â”‚
    â”‚   points: -50  â—„â”€â”€ NEGATIVE (reversal)   â”‚
    â”‚   description: "Reversal for sale #..."  â”‚
    â”‚   referenceId: saleId                    â”‚
    â”‚   timestamp: now                         â”‚
    â”‚ }                                        â”‚
    â”‚                                          â”‚
    â”‚ This creates audit trail for points     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PATCH: customers table [customerId]      â”‚
    â”‚                                          â”‚
    â”‚ Update:                                  â”‚
    â”‚ loyaltyPoints: 100 - 50 = 50             â”‚
    â”‚                    â†‘ SUBTRACT            â”‚
    â”‚                                          â”‚
    â”‚ Ensure: Math.max(0, newPoints)           â”‚
    â”‚ âœ“ Never goes below 0                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Loyalty Points REVERSED                â”‚
    â”‚    Customer balance updated              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP 5: Record Discount Reversal
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check: originalSale.discount > 0 ?       â”‚
    â”‚                                          â”‚
    â”‚ IF YES:                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT: refundAuditTrail                 â”‚
    â”‚                                          â”‚
    â”‚ {                                        â”‚
    â”‚   actionType: "discount_reversal"        â”‚
    â”‚   notes: "Discount: X (in refund Y)"     â”‚
    â”‚ }                                        â”‚
    â”‚                                          â”‚
    â”‚ This documents discount reversal        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Discount Reversal RECORDED             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP 6: Record Tax Reversal
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check: originalSale.tax > 0 ?            â”‚
    â”‚                                          â”‚
    â”‚ IF YES:                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT: refundAuditTrail                 â”‚
    â”‚                                          â”‚
    â”‚ {                                        â”‚
    â”‚   actionType: "tax_reversal"             â”‚
    â”‚   notes: "Tax: X (in refund Y)"          â”‚
    â”‚ }                                        â”‚
    â”‚                                          â”‚
    â”‚ This documents tax reversal             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… Tax Reversal RECORDED                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STEP 7: Final Comprehensive Audit Trail
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT: refundAuditTrail                 â”‚
    â”‚                                          â”‚
    â”‚ {                                        â”‚
    â”‚   actionType: "completed"                â”‚
    â”‚   performedBy: userId                    â”‚
    â”‚   performedByName: userName              â”‚
    â”‚   timestamp: now                         â”‚
    â”‚   notes: "âœ… UNDO SALE COMPLETED"        â”‚
    â”‚                                          â”‚
    â”‚   Details logged:                        â”‚
    â”‚   â€¢ All 7 steps completed âœ…             â”‚
    â”‚   â€¢ Sale marked as cancelled âœ…          â”‚
    â”‚   â€¢ Payment reversed (amount) âœ…         â”‚
    â”‚   â€¢ Stock restored (qty items) âœ…        â”‚
    â”‚   â€¢ Loyalty points reversed âœ…           â”‚
    â”‚   â€¢ Return condition documented âœ…       â”‚
    â”‚   â€¢ Inspection notes recorded âœ…         â”‚
    â”‚ }                                        â”‚
    â”‚                                          â”‚
    â”‚ This final entry confirms completion    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… AUDIT TRAIL COMPLETE                   â”‚
    â”‚    All 7 steps verified & logged         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              END OF UNDO SALE PROCESS                   â”‚
    â”‚                                                         â”‚
    â”‚  Return to Frontend:                                   â”‚
    â”‚  {                                                     â”‚
    â”‚    success: true                                       â”‚
    â”‚    refundId: "REF-xxx"                                 â”‚
    â”‚    message: "Sale completely undone. All trans..."     â”‚
    â”‚  }                                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend: Real-time UI Updates          â”‚
    â”‚                                          â”‚
    â”‚  1. Toast: "âœ… Success!" appears         â”‚
    â”‚  2. Refund list updates                  â”‚
    â”‚  3. Sales list refreshes                 â”‚
    â”‚  4. Stock numbers update                 â”‚
    â”‚  5. All UI reflects final state         â”‚
    â”‚  6. Completed tab shows refund          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š à¦¡à§‡à¦Ÿà¦¾ à¦¸à§à¦Ÿà§‡à¦Ÿ à¦šà§‡à¦à§à¦œ à¦®à§à¦¯à¦¾à¦Ÿà§à¦°à¦¿à¦•à§à¦¸

### Before UNDO SALE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BEFORE REFUND COMPLETION     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ SALES TABLE:                         â”‚
â”‚ â”œâ”€ saleNumber: "SAL-001"             â”‚
â”‚ â”œâ”€ status: "completed"               â”‚
â”‚ â”œâ”€ customerId: "CUST-001"            â”‚
â”‚ â”œâ”€ items: [{...}, {...}]             â”‚
â”‚ â””â”€ total: 1000                       â”‚
â”‚                                      â”‚
â”‚ PRODUCTS TABLE:                      â”‚
â”‚ â”œâ”€ Item 1: currentStock = 3          â”‚
â”‚ â””â”€ Item 2: currentStock = 8          â”‚
â”‚                                      â”‚
â”‚ CUSTOMERS TABLE:                     â”‚
â”‚ â”œâ”€ customerId: "CUST-001"            â”‚
â”‚ â”œâ”€ loyaltyPoints: 150                â”‚
â”‚ â””â”€ lastPurchase: "SAL-001"           â”‚
â”‚                                      â”‚
â”‚ REFUNDS TABLE:                       â”‚
â”‚ â”œâ”€ refundNumber: "REF-001"           â”‚
â”‚ â”œâ”€ status: "processed"               â”‚
â”‚ â””â”€ items: [{...}, {...}]             â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After UNDO SALE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AFTER REFUND COMPLETION         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ SALES TABLE:                         â”‚
â”‚ â”œâ”€ saleNumber: "SAL-001"             â”‚
â”‚ â”œâ”€ status: "cancelled" â—„â”€â”€ CHANGED   â”‚
â”‚ â”œâ”€ customerId: "CUST-001"            â”‚
â”‚ â”œâ”€ items: [{...}, {...}]             â”‚
â”‚ â””â”€ total: 1000 (unchanged)           â”‚
â”‚                                      â”‚
â”‚ PRODUCTS TABLE:                      â”‚
â”‚ â”œâ”€ Item 1: currentStock = 5 â—„â”€â”€ +2   â”‚
â”‚ â””â”€ Item 2: currentStock = 10 â—„â”€â”€ +2  â”‚
â”‚                                      â”‚
â”‚ CUSTOMERS TABLE:                     â”‚
â”‚ â”œâ”€ customerId: "CUST-001"            â”‚
â”‚ â”œâ”€ loyaltyPoints: 100 â—„â”€â”€ -50        â”‚
â”‚ â””â”€ lastPurchase: unchanged           â”‚
â”‚                                      â”‚
â”‚ REFUNDS TABLE:                       â”‚
â”‚ â”œâ”€ refundNumber: "REF-001"           â”‚
â”‚ â”œâ”€ status: "completed" â—„â”€â”€ CHANGED   â”‚
â”‚ â”œâ”€ isReturned: true â—„â”€â”€ NEW          â”‚
â”‚ â””â”€ items: [{...}, {...}]             â”‚
â”‚                                      â”‚
â”‚ AUDIT TRAILS TABLE: â—„â”€â”€ ALL LOGGED   â”‚
â”‚ â”œâ”€ created                           â”‚
â”‚ â”œâ”€ approved                          â”‚
â”‚ â”œâ”€ processed                         â”‚
â”‚ â”œâ”€ discount_reversal                 â”‚
â”‚ â”œâ”€ tax_reversal                      â”‚
â”‚ â”œâ”€ completed                         â”‚
â”‚ â””â”€ (7 total entries)                 â”‚
â”‚                                      â”‚
â”‚ STOCK MOVEMENTS TABLE: â—„â”€â”€ LOGGED    â”‚
â”‚ â””â”€ Type: "in", Qty: 4 total          â”‚
â”‚                                      â”‚
â”‚ POINTS TRANSACTIONS TABLE: â—„â”€â”€ LOG   â”‚
â”‚ â””â”€ Points: -50                       â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ à¦°à¦¿à¦¯à¦¼à§‡à¦²-à¦Ÿà¦¾à¦‡à¦® à¦¸à¦¿à¦™à§à¦• à¦«à§à¦²à§‹

```
Backend à¦¤à§à¦¯à¦¾à¦ª 1: Sales status change
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Convex DB: sales.status = "cancelled"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ Automatic notification
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: useQuery(api.sales.list) triggers â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ Re-fetch with new data
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component: Sales list component updates     â”‚
â”‚ Old sale:  REMOVED (cancelled filter)       â”‚
â”‚ DOM:       Re-renders                        â”‚
â”‚ User sees: Sale no longer in active list    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Backend à¦¤à§à¦¯à¦¾à¦ª 2: Product stock change
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Convex DB: products.currentStock increased  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ Automatic notification
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: useQuery(api.products.list) tr.   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ Re-fetch with new stock
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component: Inventory component updates      â”‚
â”‚ Stock qty: Shows new (increased) value      â”‚
â”‚ DOM:       Re-renders stock display         â”‚
â”‚ User sees: Updated inventory counts         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Backend à¦¤à§à¦¯à¦¾à¦ª 3: Customer loyalty change
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Convex DB: customers.loyaltyPoints reduced  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ Automatic notification
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: useQuery(api.customers...) tr.    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ Re-fetch with new points
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component: Customer profile updates         â”‚
â”‚ Loyalty Pts: Shows reduced balance          â”‚
â”‚ DOM:       Re-renders points display        â”‚
â”‚ User sees: Updated customer profile         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” à¦¡à§‡à¦Ÿà¦¾ à¦‡à¦¨à¦Ÿà¦¿à¦—à§à¦°à¦¿à¦Ÿà¦¿ à¦šà§‡à¦•

### à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¿ à¦…à¦ªà¦¾à¦°à§‡à¦¶à¦¨à§‡ à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à¦¯à¦¼:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATA INTEGRITY VALIDATION                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Input Level âœ“                                          â”‚
â”‚  â”œâ”€ Type checking (TypeScript)                          â”‚
â”‚  â”œâ”€ Format validation (email, phone)                    â”‚
â”‚  â”œâ”€ Range validation (quantities > 0)                   â”‚
â”‚  â””â”€ Required field checks                              â”‚
â”‚                                                         â”‚
â”‚  Business Logic Level âœ“                                 â”‚
â”‚  â”œâ”€ Stock sufficiency check                            â”‚
â”‚  â”œâ”€ Refund window validation                           â”‚
â”‚  â”œâ”€ Policy compliance check                            â”‚
â”‚  â””â”€ Amount calculations verify                         â”‚
â”‚                                                         â”‚
â”‚  Database Level âœ“                                       â”‚
â”‚  â”œâ”€ Referential integrity (IDs exist)                   â”‚
â”‚  â”œâ”€ Uniqueness constraints (email, phone)              â”‚
â”‚  â”œâ”€ Foreign key relationships                          â”‚
â”‚  â””â”€ Transaction consistency                           â”‚
â”‚                                                         â”‚
â”‚  Post-Operation Level âœ“                                 â”‚
â”‚  â”œâ”€ Stock total = sum of branches                       â”‚
â”‚  â”œâ”€ Loyalty points â‰¥ 0                                  â”‚
â”‚  â”œâ”€ Refund = sum of items                              â”‚
â”‚  â””â”€ All audit trails created                           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ à¦®à¦¾à¦²à§à¦Ÿà¦¿-à¦Ÿà§‡à¦¬à¦² à¦Ÿà§à¦°à¦¾à¦¨à¦œà§‡à¦•à¦¶à¦¨ à¦­à¦¿à¦œà§à¦¯à¦¼à¦¾à¦²à¦¾à¦‡à¦œà§‡à¦¶à¦¨

```
Refund Complete Operation:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ATOMIC-LIKE SEQUENCE (All or error)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  1. refunds PATCH         âœ“  status â†’ completed       â”‚
â”‚     â””â”€ Audit trail        âœ“  INSERTED                  â”‚
â”‚                                                        â”‚
â”‚  2. sales PATCH           âœ“  status â†’ cancelled       â”‚
â”‚     â””â”€ Audit trail        âœ“  INSERTED                  â”‚
â”‚                                                        â”‚
â”‚  3. FOR EACH product:                                 â”‚
â”‚     â”œâ”€ stockMovements     âœ“  INSERTED                 â”‚
â”‚     â”œâ”€ products PATCH     âœ“  stock updated           â”‚
â”‚     â””â”€ Audit trail        âœ“  IMPLICIT                 â”‚
â”‚                                                        â”‚
â”‚  4. customers PATCH       âœ“  loyalty points updated   â”‚
â”‚     â”œâ”€ pointsTransactions âœ“  INSERTED                 â”‚
â”‚     â””â”€ Audit trail        âœ“  INSERTED                 â”‚
â”‚                                                        â”‚
â”‚  5. refundAuditTrail      âœ“  Final entry INSERTED     â”‚
â”‚     â””â”€ Confirmation       âœ“  Complete                  â”‚
â”‚                                                        â”‚
â”‚  Result: All changes committed âœ“                      â”‚
â”‚  Or: Error thrown, no partial changes                 â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ à¦¡à§‡à¦Ÿà¦¾ à¦¸à¦¾à¦®à¦à§à¦œà¦¸à§à¦¯ à¦—à§à¦¯à¦¾à¦°à¦¾à¦¨à§à¦Ÿà¦¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DATA CONSISTENCY GUARANTEES                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  âœ… GUARANTEE 1: Stock Total Consistency        â”‚
â”‚     globalStock === Î£(branchStock)              â”‚
â”‚     Always maintained by code                   â”‚
â”‚                                                  â”‚
â”‚  âœ… GUARANTEE 2: Non-Negative Loyalty           â”‚
â”‚     loyaltyPoints â‰¥ 0 (always)                  â”‚
â”‚     Protected by: Math.max(0, newPoints)       â”‚
â”‚                                                  â”‚
â”‚  âœ… GUARANTEE 3: Refund Amount Precision        â”‚
â”‚     refundAmount === Î£(selectedItems)           â”‚
â”‚     Calculated before insertion                 â”‚
â”‚                                                  â”‚
â”‚  âœ… GUARANTEE 4: Audit Trail Completeness       â”‚
â”‚     All state changes logged                    â”‚
â”‚     With user, timestamp, details              â”‚
â”‚                                                  â”‚
â”‚  âœ… GUARANTEE 5: Referential Integrity          â”‚
â”‚     All IDs reference valid records             â”‚
â”‚     Checked before use                          â”‚
â”‚                                                  â”‚
â”‚  âœ… GUARANTEE 6: No Orphaned Records            â”‚
â”‚     All related data updated together           â”‚
â”‚     In proper sequence                          â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ à¦à¦°à¦° à¦¹à§à¦¯à¦¾à¦¨à§à¦¡à¦²à¦¿à¦‚ à¦«à§à¦²à§‹

```
Operation Attempt
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Try Block Execution         â”‚
â”‚                              â”‚
â”‚  1. Validate inputs          â”‚
â”‚  2. Check permissions        â”‚
â”‚  3. Lookup records           â”‚
â”‚  4. Verify business logic    â”‚
â”‚  5. Execute mutations        â”‚
â”‚  6. Create audit trails      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                        â–¼
     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            â”‚ Frontend: Toast       â”‚
     â”‚            â”‚ "âœ… Success"         â”‚
     â”‚            â”‚                      â”‚
     â”‚            â”‚ UI Updates:          â”‚
     â”‚            â”‚ - Form resets        â”‚
     â”‚            â”‚ - Lists refresh      â”‚
     â”‚            â”‚ - Component updates  â”‚
     â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€ Error â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Catch Block Execution        â”‚
            â”‚                              â”‚
            â”‚ 1. Identify error type       â”‚
            â”‚ 2. Log to console            â”‚
            â”‚ 3. Create user message       â”‚
            â”‚ 4. No DB changes made        â”‚
            â”‚ 5. State unchanged           â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Frontend: Toast           â”‚
            â”‚ "âŒ Error: message"      â”‚
            â”‚                          â”‚
            â”‚ UI State:                â”‚
            â”‚ - Form remains           â”‚
            â”‚ - Data unchanged         â”‚
            â”‚ - User can retry         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” à¦ªà¦¾à¦°à¦«à¦°à¦®à§à¦¯à¦¾à¦¨à§à¦¸ à¦…à¦ªà¦Ÿà¦¿à¦®à¦¾à¦‡à¦œà§‡à¦¶à¦¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PERFORMANCE OPTIMIZATION POINTS       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  Database Indexing âœ“                       â”‚
â”‚  â”œâ”€ sales indexed by status, customer     â”‚
â”‚  â”œâ”€ refunds indexed by approval_status    â”‚
â”‚  â”œâ”€ products indexed by category          â”‚
â”‚  â””â”€ customers searchable                  â”‚
â”‚                                            â”‚
â”‚  Query Optimization âœ“                      â”‚
â”‚  â”œâ”€ Limit result sets (100-200 items)    â”‚
â”‚  â”œâ”€ Filter early (client-side filtered)   â”‚
â”‚  â”œâ”€ Use withIndex for lookups             â”‚
â”‚  â””â”€ No N+1 queries                        â”‚
â”‚                                            â”‚
â”‚  Frontend Optimization âœ“                   â”‚
â”‚  â”œâ”€ Real-time binding (useQuery)          â”‚
â”‚  â”œâ”€ No unnecessary re-renders             â”‚
â”‚  â”œâ”€ Memoization where needed              â”‚
â”‚  â””â”€ Efficient state management            â”‚
â”‚                                            â”‚
â”‚  Network Optimization âœ“                    â”‚
â”‚  â”œâ”€ Batch operations where possible       â”‚
â”‚  â”œâ”€ Minimize data transfer                â”‚
â”‚  â”œâ”€ Async mutations (non-blocking)        â”‚
â”‚  â””â”€ Timeout handling implemented          â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**à¦¡à¦¾à¦¯à¦¼à¦¾à¦—à§à¦°à¦¾à¦® à¦†à¦ªà¦¡à§‡à¦Ÿ**: January 31, 2026
**à¦¸à¦‚à¦¸à§à¦•à¦°à¦£**: 1.0 - Complete Architecture
**à¦¸à§à¦¥à¦¿à¦¤à¦¿**: âœ… Verified and Documented

