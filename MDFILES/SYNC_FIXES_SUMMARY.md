## ржбрзЗржЯрж╛ рж╕рж┐ржЩрзНржХ рж╕ржВржХрзНрж╖рж┐ржкрзНржд рж╕рж╛рж░рж╛ржВрж╢

**ржЖржкржбрзЗржЯ рж╕ржорзНржкржирзНржи**: рзирзжрзирзм-рзжрзз-рзйрзж

---

## ржХрзА рж╕ржорж╕рзНржпрж╛ ржЫрж┐рж▓?

ржЗржиржнрзЗржирзНржЯрж░рж┐, рж░рж┐ржкрзЛрж░рзНржЯ, ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб ржПржмржВ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ ржоржзрзНржпрзЗ ржбрзЗржЯрж╛ рж╕рж┐ржЩрзНржХ рж░рж╛ржЦрж╛ рж╣ржпрж╝ржирж┐ред ржкрзНрж░ржзрж╛ржи рж╕ржорж╕рзНржпрж╛ржЧрзБрж▓рж┐ ржЫрж┐рж▓:

### рзз. **ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржЖржкржбрзЗржЯрзЗ branchStock рж╕рж┐ржЩрзНржХ ржирж╛ рж╣ржУржпрж╝рж╛**
- ржпржЦржи `minStockLevel` ржмрж╛ `maxStockLevel` ржЖржкржбрзЗржЯ рж╣рждрзЛ, рж╢рзБржзрзБржорж╛рждрзНрж░ ржЧрзНрж▓рзЛржмрж╛рж▓ ржлрж┐рж▓рзНржб ржЖржкржбрзЗржЯ рж╣рждрзЛ
- ржкрзНрж░рждрж┐ржЯрж┐ рж╢рж╛ржЦрж╛рж░ `branchStock` ржПржирзНржЯрзНрж░рж┐ ржЖржкржбрзЗржЯ рж╣рждрзЛ ржирж╛
- **ржлрж▓рж╛ржлрж▓**: рж╕рзНржЯржХ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржПржмржВ рж░рж┐ржкрзЛрж░рзНржЯрзЗ ржнрзБрж▓ ржбрзЗржЯрж╛ ржжрзЗржЦрж╛ ржпрзЗржд

### рзи. **ржмрж┐ржХрзНрж░ржпрж╝рзЗ branchStock ржЖржкржбрзЗржЯ ржирж╛ рж╣ржУржпрж╝рж╛**
- ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ рж╕ржоржпрж╝ рж╢рзБржзрзБржорж╛рждрзНрж░ ржЧрзНрж▓рзЛржмрж╛рж▓ `currentStock` ржХржорждрзЛ
- рж╢рж╛ржЦрж╛-ржирж┐рж░рзНржжрж┐рж╖рзНржЯ `branchStock` ржЕрзНржпрж╛рж░рзЗ ржЖржкржбрзЗржЯ рж╣рждрзЛ ржирж╛
- **ржлрж▓рж╛ржлрж▓**: рж╕рзНржЯржХ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯрзЗ рж╢рж╛ржЦрж╛рж░ ржкрзНрж░ржХрзГржд рж╕рзНржЯржХ рж╕ржарж┐ржХ ржЫрж┐рж▓ ржирж╛

### рей. **рж╕рзНржЯржХ рж╕рж╛ржоржЮрзНржЬрж╕рзНржпрзЗ branchStock ржЖржкржбрзЗржЯ ржирж╛ рж╣ржУржпрж╝рж╛**
- рж╕рзНржЯржХ ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓ рж╕рж╛ржоржЮрзНржЬрж╕рзНржпрзЗрж░ рж╕ржоржпрж╝ branchStock ржЖржкржбрзЗржЯ рж╣рждрзЛ ржирж╛
- **ржлрж▓рж╛ржлрж▓**: рж╢рж╛ржЦрж╛рж░ рж╕рзНржЯржХ ржбрзЗржЯрж╛ ржЕрж╕рж╛ржоржЮрзНржЬрж╕рзНржпржкрзВрж░рзНржг ржЫрж┐рж▓

---

## ржХрзА ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ?

### тЬЕ **ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржЖржкржбрзЗржЯ рж╕ржВрж╢рзЛржзржи** (`convex/products.ts`)
```typescript
// ржПржЦржи ржкрзНрж░рждрж┐ржЯрж┐ рж╢рж╛ржЦрж╛рж░ рж╕рзНржЯржХ рж▓рзЗржнрзЗрж▓ ржЖржкржбрзЗржЯ рж╣ржпрж╝
if (updateData.minStockLevel !== existingProduct.minStockLevel ||
    updateData.maxStockLevel !== existingProduct.maxStockLevel) {
  updatedBranchStock = existingProduct.branchStock.map((bs: any) => ({
    ...bs,
    minStockLevel: updateData.minStockLevel,
    maxStockLevel: updateData.maxStockLevel,
  }));
}
```

### тЬЕ **ржмрж┐ржХрзНрж░ржпрж╝ рж╕рзНржЯржХ ржЖржкржбрзЗржЯ рж╕ржВрж╢рзЛржзржи** (`convex/sales.ts`)
```typescript
// ржПржЦржи branchStock ржПржмржВ currentStock ржЙржнржпрж╝ржЗ ржЖржкржбрзЗржЯ рж╣ржпрж╝
const updatedBranchStock = product.branchStock.map((bs: any) => {
  if (bs.branchId === defaultBranch._id) {
    return {
      ...bs,
      currentStock: Math.max(0, bs.currentStock - item.quantity),
    };
  }
  return bs;
});

await ctx.db.patch(item.productId, {
  currentStock: Math.max(0, newStock),
  branchStock: updatedBranchStock,
});
```

### тЬЕ **рж╕рзНржЯржХ рж╕рж╛ржоржЮрзНржЬрж╕рзНржп рж╕ржВрж╢рзЛржзржи** (`convex/products.ts`)
```typescript
// ржПржЦржи ржбрж┐ржлрж▓рзНржЯ рж╢рж╛ржЦрж╛рж░ branchStock рж╕рж╛ржоржЮрзНржЬрж╕рзНржп рж╣ржпрж╝
const defaultBranch = await ctx.db.query("branches").first();
let updatedBranchStock = product.branchStock;

if (defaultBranch && defaultBranch._id) {
  updatedBranchStock = product.branchStock.map((bs: any) => {
    if (bs.branchId === defaultBranch._id) {
      return { ...bs, currentStock: args.newStock };
    }
    return bs;
  });
}

await ctx.db.patch(args.productId, {
  currentStock: args.newStock,
  branchStock: updatedBranchStock,
});
```

### тЬЕ **ржЗржиржнрзЗржирзНржЯрж░рж┐ ржПржбрж┐ржЯ рж╕ржВрж╢рзЛржзржи** (`src/components/Inventory.tsx`)
```typescript
// рж╕рж┐рж╕рзНржЯрзЗржо ржлрж┐рж▓рзНржб ржПржЦржи ржлрж┐рж▓рзНржЯрж╛рж░ ржХрж░рж╛ рж╣ржпрж╝
const { _id, _creationTime, branchStock, currentStock, ...productData } = editingProduct;
await updateProduct({
  id: _id,
  name: productData.name,
  // рж╢рзБржзрзБржорж╛рждрзНрж░ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржлрж┐рж▓рзНржб...
});
```

---

## ржкрзНрж░ржнрж╛ржм

### ЁЯОп **ржЗржиржнрзЗржирзНржЯрж░рж┐ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ**
- тЬЕ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржПржбрж┐ржЯ ржХрж░рж╛ ржПржЦржи рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ
- тЬЕ рж╕ржХрж▓ рж╢рж╛ржЦрж╛ржпрж╝ рж╕рзНржЯржХ рж▓рзЗржнрзЗрж▓ рж╕рж┐ржЩрзНржХ ржерж╛ржХрзЗ

### ЁЯОп **рж╕рзНржЯржХ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ**
- тЬЕ ржкрзНрж░рждрж┐ржЯрж┐ рж╢рж╛ржЦрж╛рж░ рж╕рзНржЯржХ рж╕ржарж┐ржХ ржорж╛ржи ржжрзЗржЦрж╛ржпрж╝
- тЬЕ рж▓рзЛ рж╕рзНржЯржХ ржУржпрж╝рж╛рж░рзНржирж┐ржВ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ

### ЁЯОп **ржмрж┐ржХрзНрж░ржпрж╝ рж╕рж┐рж╕рзНржЯрзЗржо**
- тЬЕ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ рж╕ржоржпрж╝ рж╕рзНржЯржХ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЖржкржбрзЗржЯ рж╣ржпрж╝
- тЬЕ рж╢рж╛ржЦрж╛ ржПржмржВ ржЧрзНрж▓рзЛржмрж╛рж▓ рж╕рзНржЯржХ рж╕ржоржирзНржмрж┐ржд ржерж╛ржХрзЗ

### ЁЯОп **рж░рж┐ржкрзЛрж░рзНржЯрж┐ржВ**
- тЬЕ рж╕ржХрж▓ рж░рж┐ржкрзЛрж░рзНржЯ рж╕ржарж┐ржХ ржбрзЗржЯрж╛ ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░рзЗ
- тЬЕ рж╕рзНржЯржХ ржнрзНржпрж╛рж▓рзБ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЧржгржирж╛ ржХрж░рж╛ рж╣ржпрж╝

### ЁЯОп **ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб**
- тЬЕ `totalInventoryValue` рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЧржгржирж╛ рж╣ржпрж╝
- тЬЕ `lowStockCount` рж╕ржарж┐ржХ ржорж╛ржи ржжрзЗржЦрж╛ржпрж╝
- тЬЕ рж╕ржХрж▓ ржорзЗржЯрзНрж░рж┐ржХрзНрж╕ рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржо ржЖржкржбрзЗржЯ рж╣ржпрж╝

---

## ржмрж┐ржжрзНржпржорж╛ржи ржХрж╛рж░рзНржпржХрж╛рж░рзА ржмрзИрж╢рж┐рж╖рзНржЯрзНржп

ржПржЗ ржлрж┐ржЪрж╛рж░ржЧрзБрж▓рж┐ ржЗрждрж┐ржоржзрзНржпрзЗ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ:

- тЬЕ **рж╕рзНржЯржХ ржЯрзНрж░рж╛ржирзНрж╕ржлрж╛рж░**: рж╢рж╛ржЦрж╛ ржерзЗржХрзЗ рж╢рж╛ржЦрж╛ржпрж╝ рж╕рзНржЯржХ рж╕ржарж┐ржХржнрж╛ржмрзЗ рж╕рзНржерж╛ржирж╛ржирзНрждрж░рж┐ржд рж╣ржпрж╝
- тЬЕ **рж╣рзЛржпрж╝рж╛ржЯрж╕ржЕрзНржпрж╛ржк ржЕрж░рзНржбрж╛рж░**: рж╕рзНржЯржХ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЖржкржбрзЗржЯ рж╣ржпрж╝
- тЬЕ **рж╕рзНржЯржХ ржорзБржнржорзЗржирзНржЯ рж▓ржЧ**: рж╕ржХрж▓ рж▓рзЗржиржжрзЗржи рж░рзЗржХрж░рзНржб ржХрж░рж╛ рж╣ржпрж╝
- тЬЕ **ржХрж╛рж╕рзНржЯржорж╛рж░ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ**: ржХрж╛рж╕рзНржЯржорж╛рж░ ржбрзЗржЯрж╛ рж╕ржарж┐ржХржнрж╛ржмрзЗ рж╕рж┐ржЩрзНржХ рж╣ржпрж╝

---

## ржкрж░ржмрж░рзНрждрзА ржкржжржХрзНрж╖рзЗржк

рж╕рж┐рж╕рзНржЯрзЗржо ржПржЦржи рж╕ржорзНржкрзВрж░рзНржгржнрж╛ржмрзЗ рж╕ржоржирзНржмрж┐рждред рж╕рзБржкрж╛рж░рж┐рж╢ржХрзГржд ржЯрзЗрж╕рзНржЯрж┐ржВ:

1. **ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржорзВрж▓рзНржп ржЖржкржбрзЗржЯ ржХрж░рзБржи** тЖТ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб ржЪрзЗржХ ржХрж░рзБржи
2. **ржмрж┐ржХрзНрж░ржпрж╝ ржХрж░рзБржи** тЖТ рж╕рзНржЯржХ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржЪрзЗржХ ржХрж░рзБржи  
3. **рж╕рзНржЯржХ ржЯрзНрж░рж╛ржирзНрж╕ржлрж╛рж░ ржХрж░рзБржи** тЖТ ржЙржнржпрж╝ рж╢рж╛ржЦрж╛ ржЪрзЗржХ ржХрж░рзБржи
4. **рж░рж┐ржкрзЛрж░рзНржЯ ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рзБржи** тЖТ рж╕ржарж┐ржХ ржбрзЗржЯрж╛ ржжрзЗржЦрзБржи

---

**рж╕ржХрж▓ рж╕рж┐ржЩрзНржХ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред рж╕рж┐рж╕рзНржЯрзЗржо ржПржЦржи рж╕ржорзНржкрзВрж░рзНржгржнрж╛ржмрзЗ ржХрж╛рж░рзНржпржХрж░ред** тЬЕ

