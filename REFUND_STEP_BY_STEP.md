## ЁЯУЛ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ Convex Dashboard ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи

ржПржЗ ржЧрж╛ржЗржбржЯрж┐ ржЖржкржирж╛ржХрзЗ ржкрзНрж░рждрж┐ржЯрж┐ ржХрзНрж▓рж┐ржХ ржПржмржВ ржкрзЗрж╕рзНржЯрзЗрж░ ржЬржирзНржп ржирж┐рж░рзНржжрзЗрж╢ржирж╛ ржжрзЗржмрзЗред

---

## ЁЯФР рж▓ржЧржЗржи ржХрж░рзБржи

1. ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржЦрзБрж▓рзБржи тЖТ `https://dashboard.convex.cloud/`
2. ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржжрж┐ржпрж╝рзЗ рж▓ржЧржЗржи ржХрж░рзБржи
3. ржЖржкржирж╛рж░ ржкрзНрж░ржЬрзЗржХрзНржЯ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи (Dubai Borka House)

---

## тП╣я╕П STEP 1: ржмрж┐ржХрзНрж░ржпрж╝ рждржерзНржп рж╕ржВржЧрзНрж░рж╣ ржХрж░рзБржи

### ржкрзНрж░ржержо ржмрж┐ржХрзНрж░ржпрж╝ ржЦрзБржБржЬрзБржи:

1. **Data** ржЯрзНржпрж╛ржм ржХрзНрж▓рж┐ржХ ржХрж░рзБржи
2. **sales** ржЯрзЗржмрж┐рж▓ ржЦрзБрж▓рзБржи
3. **ржлрж┐рж▓рзНржЯрж╛рж░ ржмрж╛ рж╕рж╛рж░рзНржЪ:**
   - рж╕рж╛рж░рзНржЪ ржмржХрзНрж╕рзЗ ржЯрж╛ржЗржк ржХрж░рзБржи: `INV-1769778062695`
   - **Enter** ржЪрж╛ржкрзБржи

4. **ржлрж▓рж╛ржлрж▓ ржерзЗржХрзЗ рж░рзЗржХрж░рзНржб ржЦрзБрж▓рзБржи ржПржмржВ ржирзЛржЯ ржХрж░рзБржи:**

| ржЬрж┐ржирж┐рж╕ | ржЖржкржирж╛рж░ ржирзЛржЯ |
|------|-----------|
| **Sale _id** | _________________ |
| **saleNumber** | INV-1769778062695 |
| **customerId** | _________________ |
| **customerName** | _________________ |
| **branchId** | _________________ |
| **branchName** | _________________ |
| **subtotal** | _________________ |
| **tax** | _________________ |
| **discount** | _________________ |
| **total** | _________________ |
| **paymentMethod** | _________________ |
| **Items Count** | _________________ |

**Items ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд:** ржкрзНрж░рждрж┐ржЯрж┐ item ржПрж░ ржЬржирзНржп:
```
Item 1:
  productId: _________________
  productName: _________________
  quantity: _________________
  unitPrice: _________________
  totalPrice: _________________
  size: _________________
```

---

### ржжрзНржмрж┐рждрзАржпрж╝ ржмрж┐ржХрзНрж░ржпрж╝ ржЦрзБржБржЬрзБржи:

ржПржХржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛, ржХрж┐ржирзНрждрзБ рж╕рж╛рж░рзНржЪ ржХрж░рзБржи: `INV-1769776643529`

| ржЬрж┐ржирж┐рж╕ | ржЖржкржирж╛рж░ ржирзЛржЯ |
|------|-----------|
| **Sale _id** | _________________ |
| **saleNumber** | INV-1769776643529 |
| **customerId** | _________________ |
| **customerName** | _________________ |
| **branchId** | _________________ |
| **branchName** | _________________ |
| **subtotal** | _________________ |
| **tax** | _________________ |
| **discount** | _________________ |
| **total** | _________________ |
| **paymentMethod** | _________________ |

---

## тП╣я╕П STEP 2: ржкрзНрж░ржержо Refund рж░рзЗржХрж░рзНржб рждрзИрж░рж┐ ржХрж░рзБржи

1. **Data** ржЯрзНржпрж╛ржмрзЗ ржпрж╛ржи
2. **refunds** ржЯрзЗржмрж┐рж▓ ржЦрзБрж▓рзБржи
3. **"+ Insert document"** ржмрж╛ржЯржи ржХрзНрж▓рж┐ржХ ржХрж░рзБржи

4. **ржирж┐ржорзНржирзЛржХрзНржд JSON рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи ржПржмржВ ржкрзЗрж╕рзНржЯ ржХрж░рзБржи:**

```json
{
  "refundNumber": "REF-1769778062695-MANUAL",
  "saleId": "PASTE_SALE_ID_1_HERE",
  "saleNumber": "INV-1769778062695",
  "branchId": "PASTE_BRANCH_ID_1_HERE",
  "branchName": "PASTE_BRANCH_NAME_1_HERE",
  "customerId": "PASTE_CUSTOMER_ID_1_HERE",
  "customerName": "PASTE_CUSTOMER_NAME_1_HERE",
  "customerPhone": "",
  "items": [
    {
      "productId": "PASTE_PRODUCT_ID_1",
      "productName": "PASTE_PRODUCT_NAME_1",
      "quantity": PASTE_QTY_1,
      "unitPrice": PASTE_UNIT_PRICE_1,
      "totalPrice": PASTE_TOTAL_PRICE_1,
      "size": null,
      "reason": "Full Refund",
      "condition": "new",
      "notes": "Admin refund"
    }
  ],
  "subtotal": PASTE_SUBTOTAL_1,
  "tax": PASTE_TAX_1,
  "discount": PASTE_DISCOUNT_1,
  "refundAmount": PASTE_TOTAL_1,
  "refundMethod": "PASTE_PAYMENT_METHOD_1",
  "originalPaymentMethod": "PASTE_PAYMENT_METHOD_1",
  "status": "pending",
  "approvalStatus": "pending_approval",
  "refundReason": "Admin Refund",
  "refundNotes": "Full refund and restock",
  "requestDate": 1738718400000,
  "isReturned": false,
  "restockRequired": true
}
```

**ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг:** 
- `PASTE_` ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ рж╣ржУржпрж╝рж╛ рж╕ржм ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝ STEP 1 ржерзЗржХрзЗ ржорзВрж▓рзНржп ржкрзЗрж╕рзНржЯ ржХрж░рзБржи
- рж╕ржВржЦрзНржпрж╛ ржорзВрж▓рзНржпрзЗрж░ ржЪрж╛рж░ржкрж╛рж╢рзЗ ржЙржжрзНржзрзГрждрж┐ ржЪрж┐рж╣рзНржи ржЫрж╛ржбрж╝рж╛ржЗ ржерж╛ржХрзБржи (e.g., `100` ржирж╛ `"100"`)

5. **"Save"** ржХрзНрж▓рж┐ржХ ржХрж░рзБржи

6. **Refund ржирждрзБржи _id ржирзЛржЯ ржХрж░рзБржи:**
   **Refund #1 _id:** _________________

---

## тП╣я╕П STEP 3: ржжрзНржмрж┐рждрзАржпрж╝ Refund рж░рзЗржХрж░рзНржб рждрзИрж░рж┐ ржХрж░рзБржи

**ржПржХржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржЕржирзБрж╕рж░ржг ржХрж░рзБржи**, ржХрж┐ржирзНрждрзБ STEP 1 ржерзЗржХрзЗ ржжрзНржмрж┐рждрзАржпрж╝ ржмрж┐ржХрзНрж░ржпрж╝рзЗрж░ ржорзВрж▓рзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:

```json
{
  "refundNumber": "REF-1769776643529-MANUAL",
  "saleId": "PASTE_SALE_ID_2_HERE",
  "saleNumber": "INV-1769776643529",
  "branchId": "PASTE_BRANCH_ID_2_HERE",
  "branchName": "PASTE_BRANCH_NAME_2_HERE",
  "customerId": "PASTE_CUSTOMER_ID_2_HERE",
  "customerName": "PASTE_CUSTOMER_NAME_2_HERE",
  "customerPhone": "",
  "items": [
    {
      "productId": "PASTE_PRODUCT_ID_2",
      "productName": "PASTE_PRODUCT_NAME_2",
      "quantity": PASTE_QTY_2,
      "unitPrice": PASTE_UNIT_PRICE_2,
      "totalPrice": PASTE_TOTAL_PRICE_2,
      "size": null,
      "reason": "Full Refund",
      "condition": "new",
      "notes": "Admin refund"
    }
  ],
  "subtotal": PASTE_SUBTOTAL_2,
  "tax": PASTE_TAX_2,
  "discount": PASTE_DISCOUNT_2,
  "refundAmount": PASTE_TOTAL_2,
  "refundMethod": "PASTE_PAYMENT_METHOD_2",
  "originalPaymentMethod": "PASTE_PAYMENT_METHOD_2",
  "status": "pending",
  "approvalStatus": "pending_approval",
  "refundReason": "Admin Refund",
  "refundNotes": "Full refund and restock",
  "requestDate": 1738718400000,
  "isReturned": false,
  "restockRequired": true
}
```

**Refund #2 _id:** _________________

---

## тП╣я╕П STEP 4: ржкрзНрж░ржержо Refund ржЕржирзБржорзЛржжржи ржХрж░рзБржи

1. **Functions** ржЯрзНржпрж╛ржм ржХрзНрж▓рж┐ржХ ржХрж░рзБржи
2. **рж╕рж╛рж░рзНржЪ ржмржХрзНрж╕рзЗ ржЯрж╛ржЗржк ржХрж░рзБржи:** `refunds.approve`
3. **ржлрж▓рж╛ржлрж▓ ржерзЗржХрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи:** `refunds.approve`

4. **Arguments рж╕рзЗржХрж╢ржирзЗ, ржПржЗ JSON ржкрзЗрж╕рзНржЯ ржХрж░рзБржи:**

```json
{
  "refundId": "PASTE_REFUND_ID_1_HERE",
  "approvalNotes": "Approved for full refund and restock"
}
```

5. **"Call Function"** ржмрж╛ржЯржи ржХрзНрж▓рж┐ржХ ржХрж░рзБржи

6. **ржлрж▓рж╛ржлрж▓ ржжрзЗржЦрзБржи:**
   ```
   тЬЕ { "success": true, "refundId": "..." }
   ```

---

## тП╣я╕П STEP 5: ржжрзНржмрж┐рждрзАржпрж╝ Refund ржЕржирзБржорзЛржжржи ржХрж░рзБржи

**ржПржХржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛:**

```json
{
  "refundId": "PASTE_REFUND_ID_2_HERE",
  "approvalNotes": "Approved for full refund and restock"
}
```

**"Call Function"** ржХрзНрж▓рж┐ржХ ржХрж░рзБржи

---

## тП╣я╕П STEP 6: ржкрзНрж░ржержо Refund ржкрзНрж░рж╕рзЗрж╕ ржХрж░рзБржи

1. **Functions** ржЯрзНржпрж╛ржм ржХрзНрж▓рж┐ржХ ржХрж░рзБржи
2. **рж╕рж╛рж░рзНржЪ ржХрж░рзБржи:** `refunds.process`
3. **ржХрзНрж▓рж┐ржХ ржХрж░рзБржи:** `refunds.process`

4. **Arguments рж╕рзЗржХрж╢ржирзЗ ржкрзЗрж╕рзНржЯ ржХрж░рзБржи:**

```json
{
  "refundId": "PASTE_REFUND_ID_1_HERE",
  "refundDetails": {
    "transactionId": "MANUAL-PROCESS-1",
    "phoneNumber": "",
    "reference": "INV-1769778062695",
    "status": "completed",
    "remark": "Manual admin process"
  }
}
```

5. **"Call Function"** ржХрзНрж▓рж┐ржХ ржХрж░рзБржи

---

## тП╣я╕П STEP 7: ржжрзНржмрж┐рждрзАржпрж╝ Refund ржкрзНрж░рж╕рзЗрж╕ ржХрж░рзБржи

**ржПржХржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛:**

```json
{
  "refundId": "PASTE_REFUND_ID_2_HERE",
  "refundDetails": {
    "transactionId": "MANUAL-PROCESS-2",
    "phoneNumber": "",
    "reference": "INV-1769776643529",
    "status": "completed",
    "remark": "Manual admin process"
  }
}
```

---

## тП╣я╕П STEP 8: ржкрзНрж░ржержо Refund рж╕ржорзНржкржирзНржи ржХрж░рзБржи (UNDO SALE)

1. **Functions** ржЯрзНржпрж╛ржм ржХрзНрж▓рж┐ржХ ржХрж░рзБржи
2. **рж╕рж╛рж░рзНржЪ ржХрж░рзБржи:** `refunds.complete`
3. **ржХрзНрж▓рж┐ржХ ржХрж░рзБржи:** `refunds.complete`

4. **Arguments рж╕рзЗржХрж╢ржирзЗ ржкрзЗрж╕рзНржЯ ржХрж░рзБржи:**

```json
{
  "refundId": "PASTE_REFUND_ID_1_HERE",
  "returnCondition": "Full Refund Completed",
  "inspectionNotes": "Admin undo sale process"
}
```

5. **"Call Function"** ржХрзНрж▓рж┐ржХ ржХрж░рзБржи

6. **ржлрж▓рж╛ржлрж▓ ржжрзЗржЦрзБржи:**
   ```
   тЬЕ {
     "success": true,
     "message": "Sale completely undone. All transactions reversed, inventory restored, loyalty points adjusted."
   }
   ```

---

## тП╣я╕П STEP 9: ржжрзНржмрж┐рждрзАржпрж╝ Refund рж╕ржорзНржкржирзНржи ржХрж░рзБржи (UNDO SALE)

**ржПржХржЗ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛:**

```json
{
  "refundId": "PASTE_REFUND_ID_2_HERE",
  "returnCondition": "Full Refund Completed",
  "inspectionNotes": "Admin undo sale process"
}
```

---

## тЬЕ VERIFICATION: рж╕ржм ржХрж┐ржЫрзБ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи

### 1. Sales ржЯрзЗржмрж┐рж▓ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:

1. **Data** тЖТ **sales** ржЯрзЗржмрж┐рж▓ ржЦрзБрж▓рзБржи
2. **рж╕рж╛рж░рзНржЪ ржХрж░рзБржи:** `INV-1769778062695`
3. **status** ржлрж┐рж▓рзНржб ржжрзЗржЦрзБржи тЖТ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд: **"cancelled"** тЬЕ
4. **рж╕рж╛рж░рзНржЪ ржХрж░рзБржи:** `INV-1769776643529`
5. **status** ржлрж┐рж▓рзНржб ржжрзЗржЦрзБржи тЖТ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд: **"cancelled"** тЬЕ

---

### 2. Refunds ржЯрзЗржмрж┐рж▓ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:

1. **Data** тЖТ **refunds** ржЯрзЗржмрж┐рж▓ ржЦрзБрж▓рзБржи
2. **ржЙржнржпрж╝ refund ржЦрзБржБржЬрзБржи**
3. **ржкрзНрж░рждрж┐ржЯрж┐ refund ржПрж░ ржЬржирзНржп ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:**
   - [ ] `status` = "completed"
   - [ ] `isReturned` = true
   - [ ] `approvalStatus` = "approved"

---

### 3. рж╕рзНржЯржХ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:

1. **Data** тЖТ **products** ржЯрзЗржмрж┐рж▓ ржЦрзБрж▓рзБржи
2. **Refund ржХрж░рж╛ ржкржгрзНржпржЧрзБрж▓рж┐ ржЦрзБржБржЬрзБржи**
3. **`currentStock` ржмрзГржжрзНржзрж┐ ржкрзЗржпрж╝рзЗржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи**

---

### 4. рж▓ржпрж╝рзНржпрж╛рж▓ржЯрж┐ ржкржпрж╝рзЗржирзНржЯ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:

1. **Data** тЖТ **customers** ржЯрзЗржмрж┐рж▓ ржЦрзБрж▓рзБржи
2. **ржЧрзНрж░рж╛рж╣ржХржжрзЗрж░ ржЦрзБржБржЬрзБржи (ржЙржнржпрж╝ ржмрж┐ржХрзНрж░ржпрж╝ ржерзЗржХрзЗ)**
3. **`loyaltyPoints` рж╣рзНрж░рж╛рж╕ ржкрзЗржпрж╝рзЗржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи**

---

### 5. ржЕржбрж┐ржЯ ржЯрзНрж░рзЗржЗрж▓ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:

1. **Data** тЖТ **refundAuditTrail** ржЯрзЗржмрж┐рж▓ ржЦрзБрж▓рзБржи
2. **ржЙржнржпрж╝ refund ржПрж░ рж╕ржм рж░рзЗржХрж░рзНржб ржжрзЗржЦрзБржи**
3. **ржкрзНрж░рждрж┐ржЯрж┐ refund ржП ржПржЗ actionType ржЧрзБрж▓рж┐ ржерж╛ржХрж╛ ржЙржЪрж┐ржд:**
   - [ ] "created"
   - [ ] "approved"
   - [ ] "processed"
   - [ ] "completed"

---

## ЁЯОЙ рж╕ржорзНржкржирзНржи!

ржпржЦржи рж╕ржм рж╕ржмрзБржЬ (тЬЕ) рж╣ржпрж╝, ржЖржкржирж┐ рж╕ржлрж▓!

**ржЪрзВржбрж╝рж╛ржирзНржд ржлрж▓рж╛ржлрж▓:**
- тЬЕ ржжрзБржЯрж┐ ржмрж┐ржХрзНрж░ржпрж╝ "cancelled" 
- тЬЕ ржкрзВрж░рзНржг ржЕрж░рзНрже рж░рж┐ржлрж╛ржирзНржб
- тЬЕ рж╕рзНржЯржХ ржкрзБржирж░рзБржжрзНржзрж╛рж░
- тЬЕ рж▓ржпрж╝рзНржпрж╛рж▓ржЯрж┐ ржкржпрж╝рзЗржирзНржЯ рж░рж┐ржнрж╛рж░рзНрж╕
- тЬЕ ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб ржЖржкржбрзЗржЯ
- тЬЕ рж░рж┐ржкрзЛрж░рзНржЯ ржЖржкржбрзЗржЯ

---

## тЪая╕П рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ:

| рж╕ржорж╕рзНржпрж╛ | рж╕ржорж╛ржзрж╛ржи |
|--------|--------|
| "Sale not found" | saleNumber рж╕ржарж┐ржХ? (INV ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ рж╣ржУржпрж╝рж╛ ржЙржЪрж┐ржд) |
| "Refund not found" | refundId рж╕ржарж┐ржХ ржХржкрж┐ ржХрж░рзЗржЫрзЗржи? |
| "Cannot process unapproved refund" | ржкржжржХрзНрж╖рзЗржк 4-5 ржорж┐рж╕ ржХрж░рзЗржЫрзЗржи? (approve ржкрзНрж░ржержорзЗ) |
| JSON ржкрж╛рж░рзНрж╕рж┐ржВ рждрзНрж░рзБржЯрж┐ | ржЙржжрзНржзрзГрждрж┐ ржПржмржВ ржХржорж╛ ржЪрзЗржХ ржХрж░рзБржи |
| рж╕рзНржЯржХ ржЖржкржбрзЗржЯ рж╣ржЪрзНржЫрзЗ ржирж╛ | `restockRequired: true` ржЖржЫрзЗ ржХрж┐ржирж╛ ржжрзЗржЦрзБржи |

